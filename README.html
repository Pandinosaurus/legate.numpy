

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Legate NumPy &mdash; legate.numpy  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/params.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/copybutton_pydocs.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Legate NumPy API Reference" href="api.html" />
    <link rel="prev" title="Welcome to Legate NumPy’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> legate.numpy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage-and-execution">Usage and Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-and-planned-features">Supported and Planned Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-types-and-dimensions">Supported Types and Dimensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#future-directions">Future Directions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#known-bugs">Known Bugs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">legate.numpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Legate NumPy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/README.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <!--
Copyright 2021 NVIDIA Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

--><div class="section" id="legate-numpy">
<h1>Legate NumPy<a class="headerlink" href="#legate-numpy" title="Permalink to this headline">¶</a></h1>
<p>Legate NumPy is a <a class="reference external" href="https://github.com/nv-legate/legate.core">Legate</a> library
that aims to provide a distributed and accelerated drop-in replacement for the
<a class="reference external" href="https://numpy.org/doc/stable/reference/">NumPy API</a> on top of the
<a class="reference external" href="https://legion.stanford.edu">Legion</a> runtime. Using Legate NumPy you do things like run
<a class="reference external" href="https://github.com/barbagroup/CFDPython/blob/master/lessons/15_Step_12.ipynb">the final example of the Python CFD course</a>
completely unmodified on 2048 A100 GPUs in a <a class="reference external" href="https://github.com/barbagroup/CFDPython/blob/master/lessons/15_Step_12.ipynb">DGX SuperPOD</a> and achieve good weak scaling.</p>
<img src="docs/figures/cfd-demo.png" alt="drawing" width="500"/><p>Legate NumPy works best for programs that have very large arrays of data
that cannot fit in the memory of a single GPU or a single node and need
to span multiple nodes and GPUs. While our implementation of the current
NumPy API is still incomplete, programs that use unimplemented features
will still work (assuming enough memory) by falling back to the
canonical NumPy implementation.</p>
<ol class="simple">
<li><p><a class="reference external" href="#dependencies">Dependencies</a></p></li>
<li><p><a class="reference external" href="#usage-and-execution">Usage and Execution</a></p></li>
<li><p><a class="reference external" href="#supported-and-planned-features">Supported and Planned Features</a></p></li>
<li><p><a class="reference external" href="#supported-types-and-dimensions">Supported Types and Dimensions</a></p></li>
<li><p><a class="reference external" href="#future-directions">Future Directions</a></p></li>
<li><p><a class="reference external" href="#known-bugs">Known Bugs</a></p></li>
</ol>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Users must have a working installation of the
<a class="reference external" href="https://github.com/nv-legate/legate.core">Legate Core</a>
library prior to installing Legate NumPy.</p>
<p>Legate NumPy requires Python &gt;= 3.6. We provide a
<a class="reference external" href="conda/legate_numpy_dev.yml">conda environment file</a> that
installs all needed dependencies in one step. Use the following command to
create a conda environment with it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">env</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">legate</span> <span class="o">-</span><span class="n">f</span> <span class="n">conda</span><span class="o">/</span><span class="n">legate_numpy_dev</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>Installation of Legate NumPy is done with either <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> for simple
uses cases or <code class="docutils literal notranslate"><span class="pre">install.py</span></code> for more advanced use cases. The most common
installation command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">core</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">legate</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">installation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This will build Legate NumPy against the Legate Core installation and then
install Legate NumPy into the same location. Users can also install Legate NumPy
into an alternative location with the canonical <code class="docutils literal notranslate"><span class="pre">--prefix</span></code> flag as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">prefix</span> <span class="o">&lt;</span><span class="n">install</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">core</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">legate</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">installation</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that after the first invocation of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> this repository will remember
which Legate Core installation to use and the <code class="docutils literal notranslate"><span class="pre">--with-core</span></code> option can be
omitted unless the user wants to change it.</p>
<p>Advanced users can also invoke <code class="docutils literal notranslate"><span class="pre">install.py</span> <span class="pre">--help</span></code> to see options for
configuring Legate NumPy by invoking the <code class="docutils literal notranslate"><span class="pre">install.py</span></code> script directly.</p>
<p>Of particular interest to Legate NumPy users will likely be the option for
specifying an installation of <a class="reference external" href="https://www.openblas.net/">OpenBLAS</a> to use.
If you already have an installation of OpenBLAS on your machine you can
inform the <code class="docutils literal notranslate"><span class="pre">install.py</span></code> script about its location using the <code class="docutils literal notranslate"><span class="pre">--with-openblas</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">openblas</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="nb">open</span><span class="o">/</span><span class="n">blas</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage-and-execution">
<h2>Usage and Execution<a class="headerlink" href="#usage-and-execution" title="Permalink to this headline">¶</a></h2>
<p>Using Legate NumPy as a replacement for NumPy is easy. Users only need
to replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">legate.numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>These programs can then be run by the Legate driver script described in the
<a class="reference external" href="https://github.com/nv-legate/legate.core">Legate Core</a> documentation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">legate</span> <span class="n">legate_numpy_program</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>For execution with multiple nodes (assuming Legate Core is installed with GASNet support)
users can supply the <code class="docutils literal notranslate"><span class="pre">--nodes</span></code> flag. For execution with GPUs, users can use the
<code class="docutils literal notranslate"><span class="pre">--gpus</span></code> flags to specify the number of GPUs to use per node. We encourage all users
to familiarize themselves with these resource flags as described in the Legate Core
documentation or simply by passing <code class="docutils literal notranslate"><span class="pre">--help</span></code> to the <code class="docutils literal notranslate"><span class="pre">legate</span></code> driver script.</p>
</div>
<div class="section" id="supported-and-planned-features">
<h2>Supported and Planned Features<a class="headerlink" href="#supported-and-planned-features" title="Permalink to this headline">¶</a></h2>
<p>Legate NumPy is currently a work in progress and we are gradually adding support for
additional NumPy operators. Unsupported NumPy operations will provide a
warning that we are falling back to canonical NumPy. Please report unimplemented
features that are necessary for attaining good performance so that we can triage
them and prioritize implementation appropriately. The more users that report an
unimplemented feature, the more we will prioritize it. Please include a pointer
to your code if possible too so we can see how you are using the feature in context.</p>
</div>
<div class="section" id="supported-types-and-dimensions">
<h2>Supported Types and Dimensions<a class="headerlink" href="#supported-types-and-dimensions" title="Permalink to this headline">¶</a></h2>
<p>Legate NumPy currently supports the following NumPy types: <code class="docutils literal notranslate"><span class="pre">float16</span></code>, <code class="docutils literal notranslate"><span class="pre">float32</span></code>, <code class="docutils literal notranslate"><span class="pre">float64</span></code>,
<code class="docutils literal notranslate"><span class="pre">int16</span></code>, <code class="docutils literal notranslate"><span class="pre">int32</span></code>, <code class="docutils literal notranslate"><span class="pre">int64</span></code>, <code class="docutils literal notranslate"><span class="pre">uint16</span></code>, <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, <code class="docutils literal notranslate"><span class="pre">uint64</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">complex64</span></code>, and <code class="docutils literal notranslate"><span class="pre">complex128</span></code>.
Legate currently also only works on up to 3D arrays at the moment. We’re currently working
on support for N-D arrays. If you have a need for arrays with more than three
dimensions please let us know about it.</p>
</div>
<div class="section" id="future-directions">
<h2>Future Directions<a class="headerlink" href="#future-directions" title="Permalink to this headline">¶</a></h2>
<p>There are three primary directions that we plan to investigate
with Legate NumPy going forward:</p>
<ul class="simple">
<li><p>More features: we plan to identify a few key lighthouse applications
and use the demands of these applications to drive the addition of
new features to Legate NumPy.</p></li>
<li><p>We plan to add support for sharded file I/O for loading and
storing large data sets that could never be loaded on a single node.
Initially this will begin with native support for <a class="reference external" href="https://www.h5py.org/">h5py</a>
but will grow to accommodate other formats needed by our lighthouse
applications.</p></li>
<li><p>Strong scaling: while Legate NumPy is currently implemented in a way that
enables weak scaling of codes on larger data sets, we would also like
to make it possible to strong-scale Legate applications for a single
problem size. This will require leveraging some of the more advanced
features of Legion from inside the Python interpreter.</p></li>
</ul>
<p>We are open to comments, suggestions, and ideas.</p>
</div>
<div class="section" id="known-bugs">
<h2>Known Bugs<a class="headerlink" href="#known-bugs" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Legate NumPy can exercise a bug in OpenBLAS when it is run with
<a class="reference external" href="https://github.com/xianyi/OpenBLAS/issues/2146">multiple OpenMP processors</a></p></li>
<li><p>On Mac OSX, Legate NumPy can trigger a bug in Apple’s implementation of libc++.
The <a class="reference external" href="https://bugs.llvm.org/show_bug.cgi?id=43764">bug</a> has since been fixed but
likely will not show up on most Apple machines for quite some time. You may have
to manually patch your implementation of libc++. If you have trouble doing this
please contact us and we will be able to help you.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="api.html" class="btn btn-neutral float-right" title="Legate NumPy API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Legate NumPy’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NVIDIA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>